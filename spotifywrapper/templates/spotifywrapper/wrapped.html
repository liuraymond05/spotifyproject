{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Spotify Wrapped</title>
    <link rel="stylesheet" href="{% static 'spotifywrapped/wrapped.css' %}">
</head>
<body>
   <div class="wrapper">
    <h1>My Spotify Wrapped</h1>
   <!-- % include 'spotifywrapper/banner.html' %} -->

    <!-- Form for selecting time range -->
    <form method="get" action="{% url 'top_spotify_data' %}">
        <label for="time_range">Select Time Range:</label>
        <select name="time_range" id="time_range">
            <option value="short_term" {% if selected_time_range == 'short_term' %}selected{% endif %}>Last 4 Weeks</option>
            <option value="medium_term" {% if selected_time_range == 'medium_term' %}selected{% endif %}>Last 6 Months</option>
            <option value="long_term" {% if selected_time_range == 'long_term' %}selected{% endif %}>Last Year</option>
        </select>
        <button type="submit">Apply</button>
    </form>

    <!-- Dynamic header based on selected time range -->
    <h1>Spotify Wrapped for the last
        {% if selected_time_range == 'short_term' %}4 weeks
        {% elif selected_time_range == 'medium_term' %}6 months
        {% elif selected_time_range == 'long_term' %}year
        {% endif %}
    </h1>

    <!-- Displaying dynamic data like top artists, tracks, etc. -->
    <div class="pic-container">
        <div id="silver-squiggle">
            <img src="../../static/spotifywrapped/silversquiggle.png" alt="Flower">
        </div>
        <div id="lavender">
            <img src="../../static/spotifywrapped/lavender.png" alt="Flower">
        </div>
    </div>

    <div class="carousel">
        <button class="arrow left" onclick="moveCarousel('left')">&#10094;</button>
        <div class="cards-container">
            <div class="card">
                <h2>Welcome to Your Spotify Wrapped!</h2>
                <p>Here's to your music taste {{ username }}!</p>
            </div>

            <div class="card">
                <h2>Top Genre</h2>
                <p>{{ top_genre }}</p>
            </div>

            <div class="card">
                <h2>Top 3 Artists</h2>
                <div class="artist-container">
                    {% for artist in top_artists %}
                        <div class="artist-card">
                            <img src="{{ artist.image }}" alt="{{ artist.name }}" class="artist-image">
                            <p class="artist-name">{{ artist.name }}</p>
                        </div>
                    {% endfor %}
                </div>
            </div>

            <div class="card">
                <h2>Total Minutes Listened</h2>
                <p>{{ total_minutes_listened }} minutes</p>
            </div>

            <div class="card">
                <h2>Top Song</h2>
                <p>{{ top_song }}</p>
            </div>

            <div class="card">
                <h2>Top Playlist</h2>
                <p>{{ top_playlist }}</p>
            </div>

            <div class="card">
                <h2>Most Played Song</h2>
                <p>{{ most_played_song }}</p>
            </div>

            <div class="card">
                <h2>Top Artist of All Time</h2>
                <p>{{ all_time_top_artist }}</p>
            </div>

            <div class="card">
                <h2>Top Tracks</h2>
                <ul>
                    {% for track in top_tracks %}
                        <li>{{ track.name }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        <button class="arrow right" onclick="moveCarousel('right')">&#10095;</button>
    </div>
</div>

<script>
    // Carousel Logic
    let currentIndex = 0;

    function moveCarousel(direction) {
        const container = document.querySelector('.cards-container');
        const cards = document.querySelectorAll('.card');
        const totalCards = cards.length;

        // Calculate card width dynamically (includes margins)
        const cardWidth = cards[0].offsetWidth;

        if (direction === 'right') {
            currentIndex = (currentIndex + 1) % totalCards; // Wrap to first card
        } else if (direction === 'left') {
            currentIndex = (currentIndex - 1 + totalCards) % totalCards; // Wrap to last card
        }

        // Slide the carousel by updating the `transform` property
        container.style.transform = `translateX(-${currentIndex * (cardWidth + 18)}px)`;
    }
</script>

</body>
</html>
